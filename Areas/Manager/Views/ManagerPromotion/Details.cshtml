@model Bloomie.Models.Entities.Promotion
@{
    ViewData["Title"] = "Chi tiết khuyến mãi";
    Layout = "~/Areas/Manager/Views/Shared/_ManagerLayout.cshtml";
}

<div class="container-fluid mt-2 p-0">
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-dark">
                    <i class="fas fa-info-circle text-primary me-2"></i> Chi tiết khuyến mãi
                </h2>
            </div>

<div class="card mb-3">
    <div class="card-header fw-bold">Thông tin chung</div>
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">Tên chương trình</dt>
            <dd class="col-sm-9">@Model.Name</dd>
            <dt class="col-sm-3">Loại</dt>
            <dd class="col-sm-9">@Model.Type</dd>
            <dt class="col-sm-3">Ngày bắt đầu</dt>
            <dd class="col-sm-9">@Model.StartDate.ToString("dd/MM/yyyy HH:mm")</dd>
            <dt class="col-sm-3">Ngày kết thúc</dt>
            <dd class="col-sm-9">@(Model.EndDate.HasValue ? Model.EndDate.Value.ToString("dd/MM/yyyy HH:mm") : "Không giới hạn")</dd>
            <dt class="col-sm-3">Trạng thái</dt>
            <dd class="col-sm-9">
                @if (Model.EndDate.HasValue && Model.EndDate.Value < DateTime.Now)
                {
                    <span class="text-danger">Hết hạn</span>
                }
                else if (Model.StartDate > DateTime.Now)
                {
                    <span class="text-warning">Chưa kích hoạt</span>
                }
                else if (Model.IsActive)
                {
                    <span class="text-success">Đang hoạt động</span>
                }
                else
                {
                    <span class="text-secondary">Ngừng</span>
                }
            </dd>
            <dt class="col-sm-3">Mô tả</dt>
            <dd class="col-sm-9">@Model.Description</dd>
        </dl>
    </div>
</div>

<!-- Hiển thị chi tiết theo loại -->
@if (Model.Type.ToString() == "Order")
{
    <div class="card mb-3">
        <div class="card-header fw-bold">Chi tiết giảm giá đơn hàng</div>
        <div class="card-body">
            <dl class="row mb-0">
                @if (ViewBag.PromoCode != null) {
                    <dt class="col-sm-4">Mã áp dụng</dt>
                    <dd class="col-sm-8">@ViewBag.PromoCode</dd>
                }
                @if (ViewBag.IsPercent != null && ViewBag.Value != null) {
                    <dt class="col-sm-4">Giá trị khuyến mãi</dt>
                    <dd class="col-sm-8">
                        @(ViewBag.IsPercent ? ($"{ViewBag.Value:N2}%") : ($"{ViewBag.Value:N0} đ"))
                    </dd>
                }
                @if (ViewBag.MaxDiscount != null && ViewBag.MaxDiscount > 0) {
                    <dt class="col-sm-4">Giá trị giảm tối đa</dt>
                    <dd class="col-sm-8">@ViewBag.MaxDiscount.ToString("N0") đ</dd>
                }
                @if (Model.MinOrderValue.HasValue) {
                    <dt class="col-sm-4">Tổng giá trị đơn hàng tối thiểu</dt>
                    <dd class="col-sm-8">@Model.MinOrderValue.Value.ToString("N0") đ</dd>
                }
                @if (Model.MinProductValue.HasValue) {
                    <dt class="col-sm-4">Tổng giá trị sản phẩm được khuyến mãi tối thiểu</dt>
                    <dd class="col-sm-8">@Model.MinProductValue.Value.ToString("N0") đ</dd>
                }
                @if (Model.MinProductQuantity.HasValue) {
                    <dt class="col-sm-4">Số lượng sản phẩm tối thiểu</dt>
                    <dd class="col-sm-8">@Model.MinProductQuantity.Value sản phẩm</dd>
                }
                @if (ViewBag.LimitTotal != null) {
                    <dt class="col-sm-4">Giới hạn tổng lượt dùng</dt>
                    <dd class="col-sm-8">@ViewBag.LimitTotal</dd>
                }
                @if (ViewBag.LimitPerCustomer != null) {
                    <dt class="col-sm-4">Giới hạn mỗi khách</dt>
                    <dd class="col-sm-8">@ViewBag.LimitPerCustomer</dd>
                }
                <dt class="col-sm-4">Kết hợp khuyến mãi</dt>
                <dd class="col-sm-8">
                    @if ((ViewBag.AllowCombineProduct as bool?) == true) { <span>Giảm giá sản phẩm</span> }
                    @if ((ViewBag.AllowCombineOrder as bool?) == true) { <span>@(((ViewBag.AllowCombineProduct as bool?) == true ? ", " : "")) Giảm giá đơn hàng</span> }
                    @if ((ViewBag.AllowCombineShipping as bool?) == true) { <span>@((((ViewBag.AllowCombineProduct as bool?) == true || (ViewBag.AllowCombineOrder as bool?) == true) ? ", " : "")) Miễn phí vận chuyển</span> }
                </dd>
            </dl>
        </div>
    </div>
}
else if (Model.Type.ToString() == "Product")
{
    <div class="card mb-3">
        <div class="card-header fw-bold">Chi tiết giảm giá sản phẩm</div>
        <div class="card-body">
            <dl class="row mb-0">
                @if (ViewBag.PromoCode != null) {
                    <dt class="col-sm-4">Mã áp dụng</dt>
                    <dd class="col-sm-8">@ViewBag.PromoCode</dd>
                }
                @if (ViewBag.IsPercent != null && ViewBag.Value != null) {
                    <dt class="col-sm-4">Giá trị khuyến mãi</dt>
                    <dd class="col-sm-8">
                        @(ViewBag.IsPercent ? ($"{ViewBag.Value:N2}%") : ($"{ViewBag.Value:N0} đ"))
                    </dd>
                }
                @if (ViewBag.MaxDiscount != null && ViewBag.MaxDiscount > 0) {
                    <dt class="col-sm-4">Giá trị giảm tối đa</dt>
                    <dd class="col-sm-8">@ViewBag.MaxDiscount.ToString("N0") đ</dd>
                }
                @if (Model.MinProductQuantity.HasValue && Model.MinProductQuantity.Value > 0) {
                    <dt class="col-sm-4">Số lượng sản phẩm tối thiểu</dt>
                    <dd class="col-sm-8">@Model.MinProductQuantity.Value sản phẩm</dd>
                }
                @if (Model.MinProductValue.HasValue && Model.MinProductValue.Value > 0) {
                    <dt class="col-sm-4">Giá trị sản phẩm tối thiểu</dt>
                    <dd class="col-sm-8">@Model.MinProductValue.Value.ToString("N0") đ</dd>
                }
                <dt class="col-sm-4">Kết hợp khuyến mãi</dt>
                <dd class="col-sm-8">
                    @if ((ViewBag.AllowCombineProduct as bool?) == true) { <span>Giảm giá sản phẩm</span> }
                    @if ((ViewBag.AllowCombineOrder as bool?) == true) { <span>@(((ViewBag.AllowCombineProduct as bool?) == true ? ", " : "")) Giảm giá đơn hàng</span> }
                    @if ((ViewBag.AllowCombineShipping as bool?) == true) { <span>@((((ViewBag.AllowCombineProduct as bool?) == true || (ViewBag.AllowCombineOrder as bool?) == true) ? ", " : "")) Miễn phí vận chuyển</span> }
                </dd>
            </dl>
            @if (ViewBag.ProductList != null && ((List<Bloomie.Models.Entities.Product>)ViewBag.ProductList).Count > 0)
            {
                <div class="mb-2"><strong>Sản phẩm áp dụng:</strong></div>
                <div class="row">
                @foreach (var p in (List<Bloomie.Models.Entities.Product>)ViewBag.ProductList)
                {
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <img src="@(p.ImageUrl ?? (p.Images != null && p.Images.Count > 0 ? p.Images.First().Url : "/images/no-image.png"))" alt="@p.Name" style="width:40px;height:40px;object-fit:cover;margin-right:8px;border-radius:4px;" />
                        <span>@p.Name</span>
                    </div>
                }
                </div>
            }
            @if (ViewBag.CategoryList != null && ((List<Bloomie.Models.Entities.Category>)ViewBag.CategoryList).Count > 0)
            {
                <div class="mb-2"><strong>Danh mục áp dụng:</strong></div>
                <ul>
                @foreach (var c in (List<Bloomie.Models.Entities.Category>)ViewBag.CategoryList)
                {
                    <li>@c.Name</li>
                }
                </ul>
            }
        </div>
    </div>
}
else if (Model.Type.ToString() == "Gift")
{
    <div class="card mb-3">
        <div class="card-header fw-bold">Chi tiết mua X tặng Y</div>
        <div class="card-body">
            <dl class="row mb-0">
                @if (ViewBag.PromoCode != null) {
                    <dt class="col-sm-4">Mã áp dụng</dt>
                    <dd class="col-sm-8">@ViewBag.PromoCode</dd>
                }
                @if (ViewBag.BuyConditionType != null && ViewBag.BuyConditionType == "MinQuantity" && ViewBag.BuyConditionValue != null) {
                    <dt class="col-sm-4">Số lượng sản phẩm tối thiểu</dt>
                    <dd class="col-sm-8">@ViewBag.BuyConditionValue sản phẩm</dd>
                }
                @if (ViewBag.BuyConditionType != null && ViewBag.BuyConditionType == "MinValue" && ViewBag.BuyConditionValueMoney != null) {
                    <dt class="col-sm-4">Giá trị sản phẩm trong đơn tối thiểu</dt>
                    <dd class="col-sm-8">@(((decimal)ViewBag.BuyConditionValueMoney).ToString("N0")) đ</dd>
                }
                @if (ViewBag.GiftQuantity != null) {
                    <dt class="col-sm-4">Số lượng sản phẩm tặng</dt>
                    <dd class="col-sm-8">@ViewBag.GiftQuantity sản phẩm</dd>
                }
                @if (ViewBag.GiftDiscountType != null) {
                    <dt class="col-sm-4">Giảm giá cho sản phẩm tặng</dt>
                    <dd class="col-sm-8">
                        @if (ViewBag.GiftDiscountType == "percent" && ViewBag.GiftDiscountValue != null) {
                            <span>Giảm @ViewBag.GiftDiscountValue% giá trị sản phẩm tặng</span>
                        }
                        else if (ViewBag.GiftDiscountType == "money" && ViewBag.GiftDiscountMoneyValue != null) {
                            <span>Giảm @(((decimal)ViewBag.GiftDiscountMoneyValue).ToString("N0"))đ cho mỗi sản phẩm tặng</span>
                        }
                        else if (ViewBag.GiftDiscountType == "free") {
                            <span>Miễn phí (giảm 100%)</span>
                        }
                        else {
                            <span>@ViewBag.GiftDiscountType</span>
                        }
                    </dd>
                }
                <dt class="col-sm-4">Kết hợp khuyến mãi</dt>
                <dd class="col-sm-8">
                    @if ((ViewBag.AllowCombineProduct as bool?) == true) { <span>Giảm giá sản phẩm</span> } 
                    @if ((ViewBag.AllowCombineOrder as bool?) == true) { <span>@(((ViewBag.AllowCombineProduct as bool?) == true ? ", " : "")) Giảm giá đơn hàng</span> }
                    @if ((ViewBag.AllowCombineShipping as bool?) == true) { <span>@((((ViewBag.AllowCombineProduct as bool?) == true || (ViewBag.AllowCombineOrder as bool?) == true) ? ", " : "")) Miễn phí vận chuyển</span> }
                </dd>
            </dl>
            <div class="mb-2"><strong>Sản phẩm/danh mục mua:</strong></div>
            @if (ViewBag.GiftBuyProducts != null && ((List<Bloomie.Models.Entities.Product>)ViewBag.GiftBuyProducts).Count > 0)
            {
                <div class="row">
                @foreach (var p in (List<Bloomie.Models.Entities.Product>)ViewBag.GiftBuyProducts)
                {
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <img src="@(p.ImageUrl ?? (p.Images != null && p.Images.Count > 0 ? p.Images.First().Url : "/images/no-image.png"))" alt="@p.Name" style="width:40px;height:40px;object-fit:cover;margin-right:8px;border-radius:4px;" />
                        <span>@p.Name</span>
                    </div>
                }
                </div>
            }
            @if (ViewBag.GiftBuyCategories != null && ((List<Bloomie.Models.Entities.Category>)ViewBag.GiftBuyCategories).Count > 0)
            {
                <ul>
                @foreach (var c in (List<Bloomie.Models.Entities.Category>)ViewBag.GiftBuyCategories)
                {
                    <li>@c.Name</li>
                }
                </ul>
            }
            <div class="mb-2 mt-3"><strong>Sản phẩm/danh mục tặng:</strong></div>
            @if (ViewBag.GiftGiftProducts != null && ((List<Bloomie.Models.Entities.Product>)ViewBag.GiftGiftProducts).Count > 0)
            {
                <div class="row">
                @foreach (var p in (List<Bloomie.Models.Entities.Product>)ViewBag.GiftGiftProducts)
                {
                    <div class="col-md-3 col-6 mb-2 d-flex align-items-center">
                        <img src="@(p.ImageUrl ?? (p.Images != null && p.Images.Count > 0 ? p.Images.First().Url : "/images/no-image.png"))" alt="@p.Name" style="width:40px;height:40px;object-fit:cover;margin-right:8px;border-radius:4px;" />
                        <span>@p.Name</span>
                    </div>
                }
                </div>
            }
            @if (ViewBag.GiftGiftCategories != null && ((List<Bloomie.Models.Entities.Category>)ViewBag.GiftGiftCategories).Count > 0)
            {
                <ul>
                @foreach (var c in (List<Bloomie.Models.Entities.Category>)ViewBag.GiftGiftCategories)
                {
                    <li>@c.Name</li>
                }
                </ul>
            }
        </div>
    </div>
}
else if (Model.Type.ToString() == "Shipping")
{
    <div class="card mb-3">
        <div class="card-header fw-bold">Chi tiết miễn phí vận chuyển</div>
        <div class="card-body">
            <dl class="row mb-0">
                @if (ViewBag.PromoCode != null) {
                    <dt class="col-sm-4">Mã áp dụng</dt>
                    <dd class="col-sm-8">@ViewBag.PromoCode</dd>
                }
                @if (ViewBag.MinOrderValue != null) {
                    <dt class="col-sm-4">Giá trị đơn hàng tối thiểu</dt>
                    <dd class="col-sm-8">@ViewBag.MinOrderValue</dd>
                }
                @if (ViewBag.UsageLimit != null) {
                    <dt class="col-sm-4">Số lần sử dụng tối đa</dt>
                    <dd class="col-sm-8">@ViewBag.UsageLimit</dd>
                }
                @if (ViewBag.LimitPerCustomer != null) {
                    <dt class="col-sm-4">Giới hạn mỗi khách</dt>
                    <dd class="col-sm-8">@ViewBag.LimitPerCustomer</dd>
                }
            </dl>
        </div>
    </div>
}

<div class="mt-4 pt-3 border-top">
    <a asp-action="Index" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-1"></i> Quay lại
    </a>
</div>
</div>
</div>
</div>

<style>
    :root {
        --primary-color: #0e7490;
        --secondary-color: #06b6d4;
        --text-dark: #1e293b;
        --text-light: #ffffff;
        --background-light: #f0fdfa;
    }
    
    h2 { 
        font-family: 'Inter', sans-serif; 
        font-size: 1.75rem; 
        font-weight: 600; 
        color: var(--text-dark); 
    }
    
    .container-fluid { 
        padding: 0 !important; 
        margin: 0 !important; 
        width: 100% !important; 
    }
    
    .card { 
        border-radius: 8px; 
        background-color: #ffffff; 
    }
    
    .card-body { 
        padding: 20px; 
    }

    .card-header {
        border-radius: 8px 8px 0 0 !important;
        padding: 12px 20px;
        background-color: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
    }

    .btn-primary, .btn-secondary {
        border-radius: 6px; 
        padding: 8px 16px; 
        font-size: 0.9rem; 
        transition: all 0.2s ease;
    }
    
    .btn-primary { 
        background-color: var(--primary-color); 
        border-color: var(--primary-color); 
    }
    
    .btn-primary:hover { 
        background-color: #0891b2; 
        border-color: #0891b2; 
        transform: translateY(-1px); 
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); 
    }

    .btn-secondary { 
        background-color: #6b7280; 
        border-color: #6b7280; 
    }
    
    .btn-secondary:hover { 
        background-color: #4b5563; 
        transform: translateY(-1px); 
    }

    .form-control, .form-select {
        border-radius: 6px;
        border: 1px solid #d1d5db;
        padding: 8px 12px;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(14, 116, 144, 0.1);
        outline: none;
    }

    .form-label {
        font-size: 0.9rem;
        color: var(--text-dark);
        margin-bottom: 6px;
        font-weight: 500;
    }

    dt {
        font-weight: 600;
        color: var(--text-dark);
    }

    dd {
        color: #4b5563;
    }
</style>
