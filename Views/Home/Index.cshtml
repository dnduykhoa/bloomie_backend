@using Bloomie.Models.Entities
@{
    ViewData["Title"] = "Trang Ch·ªß - Bloomie Flower Shop";
    var isAuthenticated = User.Identity?.IsAuthenticated ?? false;
    var newProducts = ViewBag.NewProducts as List<Product> ?? new List<Product>();
    var promotionProducts = ViewBag.PromotionProducts as List<Product> ?? new List<Product>();
    var topReviews = ViewBag.TopReviews as List<Rating> ?? new List<Rating>();
    var productDiscountPrices = ViewBag.ProductDiscountPrices as Dictionary<int, (decimal originalPrice, decimal discountedPrice, string discountType, decimal discountValue)> ?? new Dictionary<int, (decimal, decimal, string, decimal)>();
    var latestBlogs = ViewBag.LatestBlogs as List<Blog> ?? new List<Blog>();
}

<style>
    /* Page Animations */
    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .section { animation: fadeInUp 0.8s ease-out; margin-bottom: 50px; }
    
    /* Hero Section */
    .hero-section {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        border-radius: 20px; padding: 60px 40px; color: white;
        margin-bottom: 50px; position: relative; overflow: hidden;
        text-align: center;
    }
    
    .hero-section::before {
        content: ''; position: absolute; top: -50%; right: -10%;
        width: 400px; height: 400px;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: float 6s ease-in-out infinite;
    }
    
    .hero-section h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
    }
    
    .hero-section p {
        font-size: 1.2rem;
        margin-bottom: 30px;
        opacity: 0.95;
        position: relative;
        z-index: 1;
    }
    
    .hero-section .hero-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
    }
    
    @@keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }
    
    /* Voucher Banner (for non-authenticated users) */
    .voucher-banner {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        border-radius: 15px; padding: 25px 30px; color: white;
        display: flex; align-items: center; justify-content: space-between;
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);
        margin-bottom: 40px; gap: 20px; flex-wrap: wrap;
    }
    
    .voucher-content { flex: 1; }
    .voucher-content h3 { font-size: 1.5rem; margin-bottom: 8px; font-weight: 600; }
    .voucher-content p { font-size: 0.95rem; margin: 0; opacity: 0.95; }
    .voucher-icon { font-size: 50px; }
    
    /* Section Title */
    .section-title { text-align: center; margin-bottom: 40px; position: relative; }
    .section-title h2 { 
        font-size: 2.2rem; 
        font-weight: 700; 
        color: #D0021B; 
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .section-title p { 
        font-size: 0.95rem; 
        color: #636e72;
        font-weight: 400;
        margin-bottom: 0;
    }
    .section-title::after {
        content: ''; display: block; width: 50px; height: 3px;
        background: #D0021B;
        margin: 15px auto 0; border-radius: 0;
    }
    
    /* CTA Buttons */
    .btn-primary-hero {
        background: white; color: #ee5a6f; padding: 14px 35px;
        border-radius: 50px; font-weight: 600; text-decoration: none;
        display: inline-block; transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        font-size: 1rem;
    }
    .btn-primary-hero:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 6px 20px rgba(0,0,0,0.3); 
        color: #ee5a6f; 
    }
    
    .btn-secondary-hero {
        background: rgba(255,255,255,0.2); color: white; padding: 14px 35px;
        border-radius: 50px; font-weight: 600; text-decoration: none;
        display: inline-block; transition: all 0.3s;
        border: 2px solid white;
        font-size: 1rem;
    }
    .btn-secondary-hero:hover { 
        background: white; 
        color: #ee5a6f;
        transform: translateY(-2px);
    }
    
    .cta-button {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white; padding: 12px 30px;
        border-radius: 50px; font-weight: 600; text-decoration: none;
        display: inline-block; transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        font-size: 0.95rem;
    }
    .cta-button:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4); 
        color: white; 
    }
    
    /* Product Card */
    .product-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        padding: 15px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-align: center;
        height: fit-content !important;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .product-card:hover { 
        transform: translateY(-8px); 
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); 
    }
    
    .product-card a {
        text-decoration: none;
    }
    
    .product-img-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 12px;
    }
    
    .product-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px;
    }
    
    .product-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #ff4757;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
    }
    
    .product-badge.promotion {
        background: linear-gradient(135deg, #ff9500 0%, #ff5722 100%);
        animation: pulse 2s ease-in-out infinite;
        box-shadow: 0 3px 12px rgba(255, 87, 34, 0.5);
        font-weight: 700;
    }
    
    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .product-card h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
        height: 45px;
        line-height: 1.2;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    .product-card h3 a {
        color: #333;
        font-family: inherit;
    }
    
    .product-card h3 a:hover {
        color: #D0021B;
    }
    
    .product-card .price {
        font-size: 1.15rem;
        font-weight: 700;
        color: #D0021B;
        margin-bottom: 15px;
    }
    
    .product-card .price-wrapper {
        margin-bottom: 15px;
    }
    
    .product-card .price-new {
        font-size: 1.25rem;
        font-weight: 700;
        color: #D0021B;
        margin-bottom: 5px;
    }
    
    .product-card .price-old {
        font-size: 0.95rem;
        font-weight: 400;
        color: #999;
        text-decoration: line-through;
    }
    
    .product-card .discount-badge {
        display: inline-block;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        color: white;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 700;
        margin-left: 8px;
        box-shadow: 0 2px 8px rgba(238, 90, 111, 0.3);
        animation: pulse-badge 2s ease-in-out infinite;
    }
    
    @@keyframes pulse-badge {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .btn-view-detail {
        width: 100%;
        padding: 10px 15px;
        background: #ffb6c1;
        border: none;
        border-radius: 8px;
        color: #fff;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: auto;
        text-decoration: none;
        display: inline-block;
    }
    
    .btn-view-detail:hover {
        background: #ff9aaa;
        color: #fff;
    }
    
    /* Feature Cards */
    .feature-card {
        background: white; border-radius: 15px; padding: 30px 25px;
        text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        transition: all 0.3s; height: 100%;
    }
    .feature-card:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
    }
    .feature-icon { font-size: 45px; margin-bottom: 15px; color: #ff6b6b; }
    .feature-card h4 { font-size: 1.15rem; font-weight: 600; color: #2d3436; margin-bottom: 12px; }
    .feature-card p { color: #636e72; font-size: 0.9rem; line-height: 1.6; }
    
    /* Testimonials */
    .testimonial-card {
        background: white; border-radius: 15px; padding: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08); height: 100%;
        display: flex; flex-direction: column;
    }
    .testimonial-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
    .testimonial-avatar {
        width: 60px; height: 60px; border-radius: 50%;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        display: flex; align-items: center; justify-content: center;
        color: white; font-size: 1.5rem; font-weight: bold; flex-shrink: 0;
    }
    .testimonial-user { flex: 1; }
    .testimonial-name { font-weight: 600; color: #2d3436; margin-bottom: 5px; }
    .testimonial-stars { color: #ffc107; font-size: 1rem; }
    .testimonial-text { color: #636e72; line-height: 1.8; flex: 1; margin-bottom: 15px; }
    .testimonial-product { font-size: 0.9rem; color: #999; font-style: italic; }
    
    /* Blog Card */
    .blog-card {
        background: white; border-radius: 15px; overflow: hidden;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08); transition: all 0.3s; height: 100%;
    }
    .blog-card:hover { transform: translateY(-10px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .blog-image { width: 100%; height: 200px; overflow: hidden; }
    .blog-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
    .blog-card:hover .blog-image img { transform: scale(1.1); }
    .blog-content { padding: 25px; }
    .blog-date { color: #999; font-size: 0.9rem; margin-bottom: 10px; }
    .blog-title { font-size: 1.2rem; font-weight: 600; color: #2d3436; margin-bottom: 15px; }
    .blog-excerpt { color: #636e72; line-height: 1.6; margin-bottom: 20px; }
    .blog-link { color: #ff6b6b; font-weight: 600; text-decoration: none; }
    .blog-link:hover { text-decoration: underline; }
</style>

<div class="container py-5">
    <!-- Hero Section -->
    @if (!isAuthenticated)
    {
        <div class="voucher-banner">
            <div class="voucher-icon">üéÅ</div>
            <div class="voucher-content">
                <h3>∆Øu ƒê√£i ƒê·∫∑c Bi·ªát Cho Th√†nh Vi√™n M·ªõi!</h3>
                <p>ƒêƒÉng k√Ω ngay ƒë·ªÉ nh·∫≠n <strong>VOUCHER GI·∫¢M GI√Å</strong> cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n</p>
            </div>
            <a asp-controller="Account" asp-action="Register" class="btn-primary-hero">
                ƒêƒÉng K√Ω Ngay
            </a>
        </div>
    }

    @if (newProducts != null && newProducts.Any())
    {
        <div class="section">
            <div class="section-title">
                <h2>S·∫£n Ph·∫©m M·ªõi Nh·∫•t</h2>
                <p>Nh·ªØng b√≥ hoa m·ªõi nh·∫•t trong b·ªô s∆∞u t·∫≠p c·ªßa ch√∫ng t√¥i</p>
            </div>
            <div class="row g-4">
                @foreach (var product in newProducts)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="product-card">
                            <div class="product-img-wrapper">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                    @{
                                        var mainImageUrl = product.ImageUrl ?? product.Images?.FirstOrDefault()?.Url ?? "/images/placeholder.jpg";
                                    }
                                    <img src="@mainImageUrl" alt="@product.Name" class="product-img" />
                                </a>
                                <span class="product-badge">M·ªöI</span>
                            </div>
                            <h3 class="mt-3">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                    @product.Name
                                </a>
                            </h3>
                            @if (productDiscountPrices.ContainsKey(product.Id))
                            {
                                var discountInfo = productDiscountPrices[product.Id];
                                <div class="price-wrapper">
                                    <div class="price-new">
                                        @discountInfo.discountedPrice.ToString("#,##0") ƒë
                                        @if (discountInfo.discountType == "percent")
                                        {
                                            <span class="discount-badge">-@discountInfo.discountValue%</span>
                                        }
                                        else if (discountInfo.discountType == "fixed_amount")
                                        {
                                            <span class="discount-badge">-@discountInfo.discountValue.ToString("#,##0")ƒë</span>
                                        }
                                    </div>
                                    <div class="price-old">@product.Price.ToString("#,##0") ƒë</div>
                                </div>
                            }
                            else
                            {
                                <div class="price">@product.Price.ToString("#,##0") ƒë</div>
                            }
                            <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn-view-detail">
                                <i class="bi bi-eye me-2"></i>Xem Chi Ti·∫øt
                            </a>
                        </div>
                    </div>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="Product" asp-action="Index" class="cta-button">
                    <i class="bi bi-grid-3x3 me-2"></i>Xem T·∫•t C·∫£
                </a>
            </div>
        </div>
    }

    @if (promotionProducts != null && promotionProducts.Any())
    {
        <div class="section">
            <div class="section-title">
                <h2>S·∫£n Ph·∫©m Khuy·∫øn M√£i</h2>
                <p>üî• Gi·∫£m gi√° ƒë·∫∑c bi·ªát - S·ªë l∆∞·ª£ng c√≥ h·∫°n</p>
            </div>
            <div class="row g-4">
                @foreach (var product in promotionProducts)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="product-card">
                            <div class="product-img-wrapper">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                    @{
                                        var mainImageUrl = product.ImageUrl ?? product.Images?.FirstOrDefault()?.Url ?? "/images/placeholder.jpg";
                                    }
                                    <img src="@mainImageUrl" alt="@product.Name" class="product-img" />
                                </a>
                                <span class="product-badge promotion">üî• GI·∫¢M GI√Å</span>
                            </div>
                            <h3 class="mt-3">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                    @product.Name
                                </a>
                            </h3>
                            @if (productDiscountPrices.ContainsKey(product.Id))
                            {
                                var discountInfo = productDiscountPrices[product.Id];
                                <div class="price-wrapper">
                                    <div class="price-new">
                                        @discountInfo.discountedPrice.ToString("#,##0") ƒë
                                        @if (discountInfo.discountType == "percent")
                                        {
                                            <span class="discount-badge">-@discountInfo.discountValue%</span>
                                        }
                                        else if (discountInfo.discountType == "fixed_amount")
                                        {
                                            <span class="discount-badge">-@discountInfo.discountValue.ToString("#,##0")ƒë</span>
                                        }
                                    </div>
                                    <div class="price-old">@product.Price.ToString("#,##0") ƒë</div>
                                </div>
                            }
                            else
                            {
                                <div class="price">@product.Price.ToString("#,##0") ƒë</div>
                            }
                            <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn-view-detail">
                                <i class="bi bi-eye me-2"></i>Xem Chi Ti·∫øt
                            </a>
                        </div>
                    </div>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="Promotion" asp-action="VoucherCampaigns" class="cta-button">
                    <i class="bi bi-gift me-2"></i>Xem Th√™m
                </a>
            </div>
        </div>
    }

    <div class="section">
        <div class="section-title">
            <h2>T·∫°i Sao Ch·ªçn Bloomie?</h2>
            <p>Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn d·ªãch v·ª• t·ªët nh·∫•t</p>
        </div>
        <div class="row g-4">
            <div class="col-md-3 col-sm-6">
                <div class="feature-card">
                    <div class="feature-icon">üöö</div>
                    <h4>Giao H√†ng Nhanh</h4>
                    <p>Giao hoa t∆∞∆°i trong v√≤ng 60 ph√∫t t·∫°i TP.HCM</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="feature-card">
                    <div class="feature-icon">üå∏</div>
                    <h4>Hoa T∆∞∆°i 100%</h4>
                    <p>Cam k·∫øt hoa lu√¥n t∆∞∆°i m·ªõi v√† ch·∫•t l∆∞·ª£ng cao nh·∫•t</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="feature-card">
                    <div class="feature-icon">ÔøΩÔøΩ</div>
                    <h4>Thi·∫øt K·∫ø ƒê·ªôc ƒê√°o</h4>
                    <p>B√≥ hoa ƒë∆∞·ª£c thi·∫øt k·∫ø b·ªüi florist chuy√™n nghi·ªáp</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="feature-card">
                    <div class="feature-icon">üí≥</div>
                    <h4>Thanh To√°n D·ªÖ D√†ng</h4>
                    <p>H·ªó tr·ª£ ƒëa d·∫°ng ph∆∞∆°ng th·ª©c thanh to√°n</p>
                </div>
            </div>
        </div>
    </div>

    @if (topReviews != null && topReviews.Any())
    {
        <div class="section">
            <div class="section-title">
                <h2>Kh√°ch H√†ng N√≥i G√¨?</h2>
                <p>Nh·ªØng ph·∫£n h·ªìi ch√¢n th·∫≠t t·ª´ kh√°ch h√†ng</p>
            </div>
            <div class="row g-4">
                @foreach (var review in topReviews.Take(6))
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="testimonial-card">
                            <div class="testimonial-header">
                                <div class="testimonial-avatar">
                                    @((review.User?.FullName ?? review.User?.UserName ?? "K")?.Substring(0, 1).ToUpper())
                                </div>
                                <div class="testimonial-user">
                                    <div class="testimonial-name">@(review.User?.FullName ?? review.User?.UserName ?? "Kh√°ch h√†ng")</div>
                                    <div class="testimonial-stars">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <i class="@(i <= review.Star ? "bi bi-star-fill" : "bi bi-star")"></i>
                                        }
                                    </div>
                                </div>
                            </div>
                            <p class="testimonial-text">@review.Comment</p>
                            <div class="testimonial-product">
                                <i class="bi bi-box-seam me-1"></i>@(review.Product?.Name ?? "")
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="ServiceReview" asp-action="Index" class="cta-button">
                    <i class="bi bi-chat-quote me-2"></i>Xem Th√™m
                </a>
            </div>
        </div>
    }

    @if (latestBlogs != null && latestBlogs.Any())
    {
        <div class="section">
            <div class="section-title">
                <h2>Blog & Tin T·ª©c</h2>
                <p>M·∫πo chƒÉm s√≥c hoa v√† xu h∆∞·ªõng trang tr√≠</p>
            </div>
            <div class="row g-4">
                @foreach (var blog in latestBlogs)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="blog-card">
                            <div class="blog-image">
                                <a href="@Url.Action("Details", "Blog", new { id = blog.Slug })">
                                    <img src="@(blog.ImageUrl ?? "/images/blog/default.jpg")" alt="@blog.Title">
                                </a>
                            </div>
                            <div class="blog-content">
                                <div class="blog-date"><i class="bi bi-calendar3 me-2"></i>@blog.PublishDate.ToString("dd/MM/yyyy")</div>
                                <h3 class="blog-title">@blog.Title</h3>
                                <p class="blog-excerpt">@(blog.Excerpt ?? "")</p>
                                <a href="@Url.Action("Details", "Blog", new { id = blog.Slug })" class="blog-link">ƒê·ªçc th√™m <i class="bi bi-arrow-right ms-1"></i></a>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="text-center mt-4">
                <a asp-controller="Blog" asp-action="Index" class="cta-button">
                    <i class="bi bi-journal-text me-2"></i>Xem T·∫•t C·∫£ B√†i Vi·∫øt
                </a>
            </div>
        </div>
    }
</div>
